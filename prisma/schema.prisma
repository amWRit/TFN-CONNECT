// ===== WHITELISTED EMAILS =====
model WhitelistEmail {
  id      String   @id @default(cuid())
  email   String   @unique
  createdAt DateTime @default(now())
}
// Final Prisma Schema - Teach For Nepal Alumni System
// Simplified, production-ready structure

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== ENUMS =====
enum PersonType {
  ALUMNI
  STAFF
  ADMIN
}

enum EduStatus {
  COMPLETED
  ENROLLED
  NOT_ENROLLED
}

enum EmpStatus {
  SEEKING
  EMPLOYED
  UNEMPLOYED
}

enum SchoolType {
  PRIMARY
  SECONDARY
  HIGHER
}

// ===== GEOGRAPHY HIERARCHY =====
model LocalGov {
  id        String   @id @default(cuid())
  name      String   @unique // "Dang", "Tanahun"
  province  String   // "Lumbini", "Bagmati"
  
  schools   School[]
  schoolGroups SchoolGroup[]
  
  createdAt DateTime @default(now())
}

model School {
  id          String        @id @default(cuid())
  name        String        // "Kushmawati Secondary School"
  localGovId  String
  district    String        // "tanahun"
  sector      String?       // "Education"
  type        SchoolType?
  
  localGov    LocalGov      @relation(fields: [localGovId], references: [id])
  placements  Placement[]
  schoolGroups SchoolGroupSchool[]
  
  createdAt   DateTime      @default(now())
}

model SchoolGroup {
  id         String   @id @default(cuid())
  name       String   // "Group 1 - Dang East"
  localGovId String
  
  localGov   LocalGov @relation(fields: [localGovId], references: [id])
  schools    SchoolGroupSchool[]
  placements Placement[]
  
  createdAt  DateTime @default(now())
}

model SchoolGroupSchool {
  schoolGroupId String
  schoolId      String
  
  schoolGroup   SchoolGroup @relation(fields: [schoolGroupId], references: [id], onDelete: Cascade)
  school        School      @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  
  @@id([schoolGroupId, schoolId])
}

// ===== PROGRAM STRUCTURE =====
model Cohort {
  id          String       @id @default(cuid())
  name        String       @unique // "Tesro Paaila", "Aatma Paaila"
  description String?
  start       DateTime?
  end         DateTime?
  
  fellowships Fellowship[]
  
  createdAt   DateTime     @default(now())
}

// ===== PLACEMENT (Core Entity - Replaces LDC) =====
model Placement {
  id             String      @id @default(cuid())
  name           String?     // "Kushmawati Placement", "Dang Group Placement"
  schoolId       String
  schoolGroupId  String?
  managerId      String      // Person managing this placement
  fellowCount    Int         @default(0)
  subjects       String[]    // ["Math", "Science"]
  
  school         School      @relation(fields: [schoolId], references: [id])
  schoolGroup    SchoolGroup? @relation(fields: [schoolGroupId], references: [id])
  manager        Person      @relation("PlacementManager", fields: [managerId], references: [id])
  fellowships    Fellowship[]
  
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
}

// ===== CORE PERSON MODEL =====
model Person {
  id             String           @id @default(cuid())
  firstName      String
  lastName       String
  dob            DateTime?
  phone1         String?
  phone2         String?
  email1         String           @unique
  email2         String?
  linkedin       String?
  profileImage   String?
  bio            String?
  
  // Status
  type           PersonType       @default(ALUMNI)
  eduStatus      EduStatus        @default(COMPLETED)
  empStatus      EmpStatus        @default(SEEKING)
  
  // Relations
  educations     Education[]
  experiences    Experience[]
  fellowships    Fellowship[]
  managedPlacements Placement[]   @relation("PlacementManager")
  jobPostings    JobPosting[]     @relation("JobPostings")
  jobApplications JobApplication[] @relation("JobApplications")
  posts          Post[]           @relation("Posts")
  comments       Comment[]        @relation("Comments")
  
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
}

// ===== ALUMNI JOURNEY =====
model Fellowship {
  id          String    @id @default(cuid())
  personId    String
  cohortId    String
  placementId String
  subjects    String[]  // Personal subjects taught
  
  person      Person    @relation(fields: [personId], references: [id], onDelete: Cascade)
  cohort      Cohort    @relation(fields: [cohortId], references: [id])
  placement   Placement @relation(fields: [placementId], references: [id])
  
  createdAt   DateTime  @default(now())
}

// ===== SUPPORTING RECORDS =====
model Education {
  id          String   @id @default(cuid())
  personId    String
  institution String   // "Tribhuvan University"
  university  String?
  level       String   // "Bachelors", "Fellowship"
  name        String   // "Bachelor of Education"
  sector      String?
  start       DateTime
  end         DateTime?
  
  person      Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
}

model Experience {
  id          String   @id @default(cuid())
  personId    String
  orgName     String
  title       String
  sector      String
  type        String   // "full_time", "fellowship", "contract"
  description String?
  start       DateTime
  end         DateTime?
  
  person           Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  experienceSkills ExperienceSkill[]
  
  createdAt   DateTime @default(now())
}

// ===== SKILLS (Optional - Add Later) =====
model Skill {
  id           String           @id @default(cuid())
  name         String           @unique
  description  String?

  experiences  ExperienceSkill[]
  categories   SkillCategory[]

  createdAt    DateTime         @default(now())
}

model SkillCategory {
  skillId     String
  categoryId  String

  skill       Skill    @relation(fields: [skillId], references: [id], onDelete: Cascade)
  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@id([skillId, categoryId])
}

model Category {
  id        String   @id @default(cuid())
  name      String   @unique
  skills    SkillCategory[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model ExperienceSkill {
  experienceId String
  skillId      String
  
  experience   Experience @relation(fields: [experienceId], references: [id], onDelete: Cascade)
  skill        Skill      @relation(fields: [skillId], references: [id])
  
  @@id([experienceId, skillId])
}

// ===== JOBS & HIRING =====
model JobPosting {
  id            String   @id @default(cuid())
  createdById   String?
  title         String
  description   String
  sector        String   // 'Education'
  requiredSkills String? // JSON array stored as string
  location      String?
  jobType       String   // 'full_time'|'part_time'|'contract'
  status        String   @default("open") // 'open'|'closed'|'filled'
  
  createdBy     Person?  @relation("JobPostings", fields: [createdById], references: [id], onDelete: SetNull)
  applications  JobApplication[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model JobApplication {
  id            String   @id @default(cuid())
  jobPostingId  String
  personId      String
  status        String   @default("applied") // 'applied'|'reviewed'|'rejected'|'accepted'
  message       String?
  
  jobPosting    JobPosting @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)
  person        Person   @relation("JobApplications", fields: [personId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime @default(now())
}

// ===== ACTIVITY FEED =====
model Post {
  id            String   @id @default(cuid())
  personId      String
  content       String
  postType      String   // 'career_update'|'job_posting'|'achievement'|'general'
  imageUrl      String?
  likes         Int      @default(0)
  
  person        Person   @relation("Posts", fields: [personId], references: [id], onDelete: Cascade)
  comments      Comment[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Comment {
  id            String   @id @default(cuid())
  postId        String
  personId      String
  content       String
  
  post          Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  person        Person   @relation("Comments", fields: [personId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
